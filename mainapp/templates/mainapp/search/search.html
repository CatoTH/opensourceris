{% extends 'base.html' %}

{% load i18n %}

{% block title %}{% trans "Search" context "page_title" %}{% endblock %}

{% block additional_html_headers %}
    <link rel="alternate" type="application/rss+xml" href="{% url 'search-feed' query %}"
          title="{% trans 'Search results' %}">
{% endblock %}

{% block header %}
    {% with disable_header_search=True main_content_id="endless-scroll-target" %}
        {{ block.super }}
    {% endwith %}
{% endblock %}

{% block content %}
    <div class="container">
        <div class="search-card card">
            <div class="card-header">
                <div class="row">
                    <div class="col col-auto no-gutters">
                        <h1 class="text-nowrap">{% trans "Search" context "page_title" %}</h1>
                    </div>
                    {# This col is both spacer and showing the loading spinner #}
                    <div class="col">
                        <div class="search-refreshing-spinner fa fa-spinner fa-spin"
                             aria-label="The search is refreshing" hidden="hidden">
                        </div>
                    </div>
                    <div class="col col-auto subscribe-widget">
                        <a class="btn btn-sm btn-light" href="{% url 'search-feed' query %}"
                           title="{% trans "Search results as RSS-Feed" %}">
                            <span class="fa fa-feed"></span>
                            <span class="sr-only">RSS-Feed</span>
                        </a>
                        {% include 'partials/subscribe_widget.html' %}
                    </div>
                </div>
            </div>
            <form id="detailed-searchform" class="section detailed-searchform p-2 mb-0" method="GET"
                  action="{% url 'search' '' %}" data-results-only-url="{% url "search_results_only" "" %}">

                <!-- Searchterm -->
                <section class="input-group position-relative">
                    <h2 class="sr-only"><label for="searchterm">
                        {% trans "Search term" context "search_form" %}
                    </label></h2>
                    <input name="searchterm" type="text" class="form-control"
                           value="{{ options.searchterm }}" id="searchfield-mousetrap" autocomplete="off"
                           data-suggest-url="{% url 'search_autocomplete' 'SEARCH_TERM' %}"
                           placeholder="{% trans "Search term" context "search_form" %}"
                           aria-label="{% trans "Search term" context "search_form" %}">
                    <button class=" search-icon fa fa-search" type="submit"
                            title="{% trans 'Show search results' context 'aria label' %}">
                        <span class="sr-only">{% trans 'Show search results' context 'aria label' %}</span>
                    </button>
                </section>
                <div class="form-row align-items-center">
                    {% include "mainapp/search/location_selector.html" %}
                    {% include "mainapp/search/document_type.html" %}
                    {% include "mainapp/search/date_range.html" %}
                    {% include "mainapp/search/filter_dropdown.html" with key="person" items=new_facets.person label="Person" init_value=options.person %}
                    {% include "mainapp/search/filter_dropdown.html" with key="organization" items=new_facets.organization label="Organization" init_value=options.organization %}
                    {% include "mainapp/search/sorter_widget.html" %}
                </div>
            </form>

            <section class="section">
                {% include "partials/mixed_results.html" %}

                <button class="btn btn-secondary w-100" id="start-endless-scroll"
                        data-url="{% url "search_results_only" query %}"
                        data-pagination-length="{{ pagination_length }}"
                        {% if total_hits == results|length %} hidden="hidden" {% endif %}>
                    <span>{% trans "Load More" %}</span>
                    <span class="total-hits badge badge-light">{{ total_hits }}</span>
                </button>

                <div class="p-2 nothing-found" {% if results|length > 0 %} hidden="hidden" {% endif %}>
                    <p class="alert alert-danger">{% trans "Nothing Found :(" %}</p>
                </div>
            </section>
        </div>
    </div>
{% endblock %}