{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ file.name }}{% endblock %}

{% block content %}
    <div class="file-main-content {{ renderer }}">
        {% comment %}
        We want to have a sidebar on the left. So what we do is to split the page in three coloumns. The left and the
        right one are auto-sized while the center one just gets the normal container class (plus a px-0). For the main
        coloumn this has the same effect as using ml-auto, except we can position our sidebar in the left space
        {% endcomment %}
        <div class="file-layout-container container-fluid h-100">
            <div class="row h-100">
                <div class="col">
                    <div class="file-switcher h-100" role="navigation">
                        <h3>{% trans "Documents in this paper" %}</h3>
                        {# Yep, those divs are actually needed :soup: #}
                        <div>
                            <div>
                                <div class="list-group list-group-flush">
                                    {% if papers.0.main_file %}
                                        {% if papers.0.main_file.id == file.id %}
                                            <a class="list-group-item list-group-item-action active scroll-into-view"
                                               href="{% url 'file' papers.0.main_file.id %}">
                                        {% else %}
                                            <a class="list-group-item list-group-item-action"
                                               href="{% url 'file' papers.0.main_file.id %}">
                                        {% endif %}
                                    <span class="fa-custom fa-file"></span>
                                    {% firstof papers.0.main_file.name papers.0.main_file.displayed_filename %}
                                    </a>
                                    {% endif %}
                                    {% for other_file in papers.0.files.all %}
                                        <a class="list-group-item list-group-item-action {% if other_file.id == file.id %}
                            active scroll-into-view{% endif %}"
                                           href="{% url 'file' other_file.id %}">
                                            <span class="fa-custom fa-file"></span>
                                            <span>{% firstof other_file.name other_file.displayed_filename other_file %}</span>
                                        </a>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-auto file-content-div">
                    <div class="file-header container d-flex justify-content-between flex-wrap">
                        <div>
                            {% if file.legal_date %}
                                <div>{{ file.legal_date }}</div>
                            {% endif %}
                            {% if file.license %}
                                <div>{{ file.license }}</div>
                            {% endif %}
                        </div>
                        <div>
                            {% spaceless %}
                                <div>
                                    <a href="{% url 'media' file.storage_filename %}">
                                        <span class="fa fa-custom fa-download" aria-hidden="true"></span>
                                        <span>Download</span>
                                    </a>
                                </div>
                                {% if papers|length == 1 %}
                                    <div>
                                        <a href="{% url 'paper' papers.0.id %}" title="{{ papers.0.name }}">
                                            <span class="fa-custom fa-file" aria-hidden="true"></span>
                                            <span>{% trans "Superordinated paper" context "Singular" %}</span>
                                        </a>
                                    </div>
                                {% endif %}
                                {% if papers|length > 1 %}
                                    <div>
                                        <div class="dropdown">
                                            <a class="dropdown-toggle" role="button" href="#"
                                               data-toggle="dropdown"
                                               aria-haspopup="true" aria-expanded="false">
                                                {% trans "Superordinated paper" context "Plural" %}
                                            </a>
                                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                {% for paper in papers %}
                                                    <a class="dropdown-item" href="{% url 'paper' paper.id %}"
                                                       title="{{ paper.name }}">
                                                        <span class="fa-custom fa-file" aria-hidden="true"></span>
                                                        <span>{% trans "Paper" %}</span>
                                                    </a>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endspaceless %}
                        </div>
                    </div>

                    <div class="{{ renderer }}-wrapper">
                        {% if renderer == "pdf" %}
                            <div class="embed-responsive w-100">
                                <iframe class="embed-responsive-item" src="{{ pdfjs_iframe_url }}"></iframe>
                            </div>
                        {% elif renderer == "txt" %}
                            <pre class="embed-responsive h-100 border">{{ file.parsed_text }}</pre>
                        {% elif renderer == "image" %}
                            <img src="{% url 'media' file.storage_filename %}" alt="{{ file.description }}"
                                 class="file-image">
                        {% elif renderer == "download" %}
                            <p class="lead">{% trans "The file can not be shown" %}</p>
                            <a class="btn btn-primary btn-lg" role="button"
                               href="{% url 'media' file.storage_filename %}"
                               download>
                                <span class="fa fa-download" aria-hidden="true"></span>
                                {% trans "Download" %}
                            </a>
                        {% else %}
                            <div class="container">
                                <p class="lead">{% trans "The file is not available" %}</p>
                            </div>
                        {% endif %}

                        {% comment %}
                        Sometimes files from eletected people countain information that must not be published on the
                        internet, e.g. copyrighted images or confidential figures, but are published anyway because
                        the administration doesn't check that. As by our experience google lists us higher than the
                        original system, we're than the ones others want to sue. That's why we add a disclaimer
                        below all files pointing to the original system where the file was originally published.
                        We also delete all files when they are deleted in the original system.
                        {% endcomment %}
                        {% if settings.FILE_DISCLAIMER %}
                            <div class="file-disclaimer">
                                <div>
                                    <span class="text-muted">{{ settings.FILE_DISCLAIMER }}</span>
                                    {% if settings.FILE_DISCLAIMER_URL %}
                                        <a href="{{ settings.FILE_DISCLAIMER_URL }}">
                                            <span class="fa fa-external-link"></span>
                                        </a>
                                    {% endif %}
                                </div>
                            </div>

                        {% endif %}
                    </div>
                </div>

                <div class="col right-counterweight">
                    {# "Counterweight" for the left col to get the main container centered #}
                </div>
            </div>
        </div>
    </div>
{% endblock %}